// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

// App that directly interact with the BrevisProof contract.
abstract contract BrevisProofApp {
    IBrevisProof public brevisProof;

    function _checkBrevisProof(bytes calldata _proof, bytes calldata _appOutput, bytes32 _appVkHash) internal {
        (, bytes32 appCommitHash, bytes32 appVkHash) = brevisProof.submitProof(uint64(block.chainid), _proof);
        require(appVkHash == _appVkHash, "mismatch vkhash");
        require(appCommitHash == keccak256(_appOutput), "invalid circuit output");
    }

    function _checkBrevisAggProof(
        uint64 _chainId,
        bytes32[] calldata _proofIds,
        bytes calldata _proofWithPubInputs,
        IBrevisProof.ProofData[] calldata _proofDataArray
    ) internal {
        brevisProof.submitAggProof(_chainId, _proofIds, _proofWithPubInputs);
        brevisProof.validateAggProofData(_chainId, _proofDataArray);
    }
}

interface IBrevisProof {
    struct ProofData {
        bytes32 commitHash;
        bytes32 vkHash;
        bytes32 appCommitHash; // zk-program computing circuit commit hash
        bytes32 appVkHash; // zk-program computing circuit Verify Key hash
        bytes32 smtRoot;
    }

    function submitProof(
        uint64 _chainId,
        bytes calldata _proofWithPubInputs
    ) external returns (bytes32 proofId, bytes32 appCommitHash, bytes32 appVkHash);

    function submitAggProof(uint64 _chainId, bytes32[] calldata _proofIds, bytes calldata _proofWithPubInputs) external;

    function validateAggProofData(uint64 _chainId, ProofData[] calldata _proofDataArray) external view;
}
